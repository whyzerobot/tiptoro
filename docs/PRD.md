# 产品需求文档 (PRD) — TipToro 智能错题分析系统

> 版本：v0.2-alpha（2026-02-21）

---

## 1. 产品概述

**产品定位**：面向初高中生的 AI 智能错题与学情分析工具。通过机器视觉和大语言模型，将繁琐的错题整理自动化，并提供深度知识点归纳与个性化学习指导。

**目标用户**
- **核心**：初中生、高中生（有自主学习意愿）
- **相关**：家长（监督进度）、教师（班级共性错题，未来规划）

---

## 2. 核心痛点

| 痛点 | 说明 |
|------|------|
| 耗时 | 手抄/剪贴错题效率极低 |
| 难复用 | 错题难检索，缺少多维分类 |
| 无反馈 | 不知道为何反复出错，缺宏观认知 |
| 缺指导 | 遇错题只看答案，缺"举一反三"训练 |

---

## 3. 功能范围

### 3.1 用户与账户

| 功能 | 状态 | 说明 |
|------|------|------|
| 邮箱注册/登录 | ✅ 已实现 | bcrypt + JWT，邮箱验证（local 打印 token） |
| 用户个人空间 | ✅ 已实现 | `soul.md`（AI 属性）+ `user.md`（学生自述） |
| 手机号登录 | 🔮 Phase 2 | 接口已预留 |
| 微信 OAuth | 🔮 Phase 2 | 接口已预留 |

### 3.2 计费与订阅

| 套餐 | 价格 | 期限 | 配额 | 状态 |
|------|------|------|------|------|
| 试用版 | ¥9.90 | 7 天 | 20 道错题 | ✅ 已实现 |
| 月度会员 | ¥49.00 | 30 天 | 无限制 | ✅ 已实现 |
| 年度会员 | ¥399.00 | 365 天 | 无限制 | ✅ 已实现 |

**激活方式（早期）**：管理员生成 HMAC 签名激活码，用户在个人中心输入激活。  
**激活码 CLI**：`python3 backend/billing/keygen_standalone.py --plan monthly`  
**Phase 2**：微信支付 / 支付宝（接口已预留 stub）

### 3.3 错题录入与解析

| 功能 | 状态 | 说明 |
|------|------|------|
| Web 批量上传 | 📋 待开发 | 多图拖拽上传 |
| 图像预处理 + OCR | 📋 待开发 | Skill: `vision-perception` |
| 手写错答单独提取 | 📋 待开发 | 百度手写 OCR |
| 人工校对界面 | 📋 待开发 | 左图右文分栏，可编辑题干+错答 |
| 结构化入库 | 📋 待开发 | Skill: `ingest-and-verify` |

### 3.4 AI 分析与标签

| 功能 | 状态 | 说明 |
|------|------|------|
| 知识点自动打标 | 📋 待开发 | Skill: `cognitive-analysis`（LLM 挂知识树） |
| 错因选择 | 📋 待开发 | 粗心/概念不清/公式错/无思路 |
| 错题本管理 | 📋 待开发 | 按学科/日期/标签/错因检索 |

### 3.5 学情分析与指导

| 功能 | 状态 | 说明 |
|------|------|------|
| 知识点掌握度雷达图 | 📋 待开发 | 可视化薄弱环节 |
| AI 学习建议 | 📋 待开发 | 针对高频错点个性化推荐（注入 user.md 上下文） |
| 举一反三题推荐 | 📋 待开发 | 基于知识节点检索/生成变式题 |
| 错题 PDF 导出 | 📋 待开发 | Skill: `report-generation` |

---

## 4. AI 个性化机制（用户空间）

每位用户拥有私有 Markdown 空间：

| 文件 | 内容 | 用途 |
|------|------|------|
| `soul.md` | AI 行为定义（语气、策略） | 注入 LLM System Prompt 前缀 |
| `user.md` | 学生自述（年级、学科、性格） | 帮助 AI 理解学生特性 |

用户可通过 Web 界面直接编辑，所有 AI 分析自动叠加这份上下文。

---

## 5. 多渠道与异步架构

- **Web 端**：MVP 主战场，PC 浏览器操作
- **消息渠道**（Phase 2）：飞书机器人、企业微信机器人（底层 API 通用设计）
- **异步处理**：OCR/LLM 等耗时 Skill 通过 Celery + Redis 任务队列异步执行（待接入）

---

## 6. 数据安全与环境

- 密钥（API Key、DB 密码、JWT Secret）统一存放 `backend/.env`，不入代码仓库
- 环境切换：`.env` 中设置 `TIPTORO_ENV=local`（SQLite + 本地存储）或 `cloud`（PostgreSQL + OSS）
- 详细配置见：[`backend/config/settings.yaml`](../backend/config/settings.yaml)

---

## 7. 技术依赖

| 服务 | 说明 |
|------|------|
| DeepSeek API | 主力 LLM（认知分析） |
| Gemini API | 文本清洗辅助 |
| Mathpix API | 印刷体公式 OCR |
| 百度手写 OCR | 手写文字识别 |
| 阿里云 OSS | 生产环境图片存储 |
| PostgreSQL | 生产数据库 |
| 微信支付 / 支付宝 | Phase 2 付款渠道 |
